<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header::common-head}">
    <!-- PAGE TITLE HERE -->
    <title th:text="${pageTitle}">Service Management - Smart Beauty</title>
</head>

<body id="bg">

<div class="page-wraper">

    <!-- HEADER START -->
    <header th:replace="~{fragments/header2::header}">
    </header>
    <!-- HEADER END -->

    <!-- CONTENT START -->
    <div class="page-content">

        <!-- BREADCRUMB ROW -->
        <div class="bg-gray-light p-tb20">
            <div class="container">
                <ul class="wt-breadcrumb breadcrumb-style-2">
                    <li><a href="javascript:void(0);"><i class="fa fa-home"></i> Home</a></li>
                    <li>Service Management</li>
                </ul>
            </div>
        </div>
        <!-- BREADCRUMB ROW END -->

        <div
                class="section-full overlay-wraper site-bg-primary"
                th:style="|background-image: url('@{/images/background/bg-7.jpg}')|"
        >
            <div class="section-content">
                <!-- CALL-TO ACTION START -->
                <div class="wt-subscribe-box">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-8 col-sm-8">
                            </div>
                            <div class="col-md-4">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADVANCED FILTER SECTION START -->
        <div class="section-full bg-white p-t40 p-b20">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="filter-wrap p-b20">
                            <h5 class="text-uppercase m-b20"><i class="fa fa-filter"></i> Advanced Service Filters</h5>

                            <form th:action="@{/services}" method="get" class="filter-form">
                                <!-- Basic Search Row -->
                                <div class="row">
                                    <!-- Search Keyword -->
                                    <div class="col-md-4 m-b15">
                                        <input type="text"
                                               name="keyword"
                                               th:value="${keyword}"
                                               placeholder="Search services by name or content..."
                                               class="form-control">
                                    </div>

                                    <!-- Search Button -->
                                    <div class="col-md-2 m-b15">
                                        <button type="submit" class="site-button btn-block">
                                            <i class="fa fa-search"></i> Search
                                        </button>
                                    </div>
                                </div>

                                <!-- Advanced Filters Row -->
                                <div class="row">

                                    <!-- Author Filter -->
                                    <div class="col-md-3 m-b15" th:if="${availableAuthors}">
                                        <label class="control-label">Created By</label>
                                        <select name="createdBy" class="form-control">
                                            <option value="">All Authors</option>
                                            <option th:each="author : ${availableAuthors}"
                                                    th:value="${author.key}"
                                                    th:text="${author.value}"
                                                    th:selected="${filterParams != null and filterParams.createdBy == author.key}">
                                            </option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Tags Filter Row -->
                                <div class="row" th:if="${availableTags != null and !availableTags.isEmpty()}">
                                    <div class="col-md-12 m-b15">
                                        <label class="control-label">Filter by Tags</label>
                                        <div class="tags-filter-container">
                                            <div class="tag-checkboxes"
                                                 style="max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #f9f9f9;">
                                                <div th:each="tag : ${availableTags}" class="checkbox-inline"
                                                     style="display: inline-block; margin-right: 15px; margin-bottom: 5px;">
                                                    <label>
                                                        <input type="checkbox"
                                                               name="selectedTags"
                                                               th:value="${tag}"
                                                               th:checked="${filterParams?.selectedTags != null and filterParams.selectedTags.contains(tag)}">
                                                        <span class="badge-info" th:text="${tag}"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hidden inputs for maintaining state -->
                                <input type="hidden" name="page" th:value="${services?.number ?: 0}">
                            </form>

                            <!-- Active Filters Display -->
                            <div class="active-filters" th:if="${hasActiveFilters}">
                                <div class="alert alert-info" style="margin-top: 15px;">
                                    <strong><i class="fa fa-filter"></i> Active Filters:</strong>
                                    <span th:each="filter, iterStat : ${activeFilters}">
                    <span class="badge badge-primary" th:text="${filter}"></span>
                    <span th:if="${!iterStat.last}">, </span>
                  </span>
                                    <a th:href="@{/services}" class="btn btn-sm btn-danger pull-right">
                                        <i class="fa fa-times"></i> Clear All Filters
                                    </a>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ADVANCED FILTER SECTION END -->

        <!-- SECTION CONTENT START -->
        <div class="section-full p-t80 p-b50">
            <div class="container">

                <!-- SERVICE LIST START -->
                <div th:if="${services != null and !services.isEmpty()}">
                    <!-- SERVICE ITEM -->
                    <div class="blog-post blog-md date-style-1 clearfix" th:each="service : ${services}">

                        <div class="wt-post-media wt-img-effect zoom-slow">

                            <!-- Service Icon/Image -->
                            <div class="service-icon-container">
                                <img th:attr="alt=${service.name}" />
                                <div class="service-icon">
                                    <i class="fa fa-spa"></i>
                                    <div class="label" th:text="${service.name}">SERVICE</div>
                                </div>
                            </div>

                            <!-- Price Badge -->
                        </div>

                        <div class="wt-post-info">
                            <div class="wt-post-title">
                                <h3 class="post-title">
                                    <a th:href="@{/services/{id}(id=${service.serviceId})}"
                                       th:text="${service.name}">Service Name</a>
                                </h3>
                            </div>

                            <div class="wt-post-meta">
                                <ul>
                                    <li class="post-date">
                                        <i class="fa fa-calendar"></i>
                                        <span th:text="'Created: ' + ${#temporals.format(service.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                                    </li>
                                    <li class="post-author" th:if="${service.createdBy}">
                                        <i class="fa fa-user"></i>
                                        <span th:text="'By: ' + ${service.createdBy}">Author</span>
                                    </li>
                                    <li class="post-duration" th:if="${service.duration}">
                                        <i class="fa fa-clock-o"></i>
                                        <span th:text="${service.duration}">Duration</span>
                                    </li>
                                    <li class="post-price">
                                        <i class="fa fa-money"></i>
                                        <span th:text="'$' + ${service.price}">$0.00</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Service Content Preview -->
                            <div class="wt-post-text">
                                <div th:if="${service.content}"
                                     th:utext="${#strings.length(service.content) > 200 ? #strings.substring(service.content, 0, 200) + '...' : service.content}">
                                </div>
                                <div th:unless="${service.content}" class="text-muted">No description available.</div>
                            </div>

                            <!-- Tags -->
                            <div class="wt-post-tags" th:if="${service.tags != null and !service.tags.isEmpty()}">
                                <i class="fa fa-tags"></i>
                                <span th:each="tag, iterStat : ${service.tags}" class="tag-item">
                  <span class="" th:text="${tag}"></span>
                </span>
                            </div>

                            <!-- Formatted Tags Alternative -->
                            <div class="wt-post-tags" th:unless="${service.tags != null and !service.tags.isEmpty()}"
                                 th:if="${formattedTags != null and formattedTags[service.serviceId] != 'No tags'}">
                                <i class="fa fa-tags"></i>
                                <span class="text-muted" th:text="${formattedTags[service.serviceId]}"></span>
                            </div>

                            <!-- Action Buttons -->
                            <div class="clearfix">
                                <div class="wt-post-readmore pull-left">
                                    <a th:href="@{/services/{id}(id=${service.serviceId})}"
                                       title="VIEW DETAILS" rel="bookmark"
                                       class="site-button radius-sm">
                                        <i class="fa fa-eye"></i> View Details
                                    </a>
                                    <a th:if="${isLoggedIn}"
                                       th:href="@{/bookings/service/{serviceId}(serviceId=${service.serviceId})}"
                                       title="BOOK NOW!" rel="bookmark"
                                       class="site-button radius-sm">
                                        <i class="fa fa-eye"></i> Book Now!
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- SERVICE ITEM END -->
                </div>

                <!-- NO SERVICES MESSAGE -->
                <div th:if="${services == null or services.isEmpty()}" class="text-center p-t50 p-b50">
                    <i class="fa fa-spa" style="font-size: 80px; color: #ccc;"></i>
                    <h4 class="text-muted m-t20">No services found</h4>
                    <p class="text-muted">
            <span th:if="${hasActiveFilters}">
              No services match your current filters. <a th:href="@{/services}">Clear filters</a> to see all services.
            </span>
                        <span th:unless="${hasActiveFilters}">
              Get started by creating your first service offering.
            </span>
                    </p>
                    <a th:href="@{/services/admin/add}" class="site-button m-t20">
                        <i class="fa fa-plus"></i> Create First Service
                    </a>
                </div>

                <!-- PAGINATION START -->
                <div class="pagination-bx clearfix" th:if="${services != null and services.totalPages > 1}">
                    <ul class="custom-pagination pagination-1">
                        <!-- Previous Page -->
                        <li th:if="${services.hasPrevious()}">
                            <a th:href="@{/services(page=${services.number - 1}, size=${services.size}, keyword=${keyword}, minPrice=${filterParams?.minPrice}, maxPrice=${filterParams?.maxPrice}, minDuration=${filterParams?.minDuration}, maxDuration=${filterParams?.maxDuration}, fromDate=${filterParams?.fromDate}, toDate=${filterParams?.toDate}, selectedTags=${filterParams?.selectedTags}, createdBy=${filterParams?.createdBy}, sortBy=${sortBy}, sortDir=${sortDir})}">&laquo;</a>
                        </li>

                        <!-- Page Numbers -->
                        <li class="page-item" th:each="pageNum : ${pageNumbers}"
                            th:classappend="${pageNum == (services.number + 1)} ? 'active' : ''">
                            <a class="page-link"
                               th:href="@{/services(page=${pageNum - 1}, size=${services.size}, keyword=${keyword}, minPrice=${filterParams?.minPrice}, maxPrice=${filterParams?.maxPrice}, minDuration=${filterParams?.minDuration}, maxDuration=${filterParams?.maxDuration}, fromDate=${filterParams?.fromDate}, toDate=${filterParams?.toDate}, selectedTags=${filterParams?.selectedTags}, createdBy=${filterParams?.createdBy}, sortBy=${sortBy}, sortDir=${sortDir})}"
                               th:text="${pageNum}"
                               th:title="'Page ' + ${pageNum}">1</a>
                        </li>

                        <!-- Next Page -->
                        <li th:if="${services.hasNext()}">
                            <a th:href="@{/services(page=${services.number + 1}, size=${services.size}, keyword=${keyword}, minPrice=${filterParams?.minPrice}, maxPrice=${filterParams?.maxPrice}, minDuration=${filterParams?.minDuration}, maxDuration=${filterParams?.maxDuration}, fromDate=${filterParams?.fromDate}, toDate=${filterParams?.toDate}, selectedTags=${filterParams?.selectedTags}, createdBy=${filterParams?.createdBy}, sortBy=${sortBy}, sortDir=${sortDir})}">&raquo;</a>
                        </li>
                    </ul>

                    <!-- Pagination Info -->
                    <div class="pagination-info text-center m-t20">
                        <p class="text-muted">
                            Showing <span th:text="${services.number * services.size + 1}">1</span> to
                            <span th:text="${services.number * services.size + services.numberOfElements}">10</span> of
                            <span th:text="${services.totalElements}">100</span> services
                        </p>
                    </div>
                </div>
                <!-- PAGINATION END -->

            </div>
        </div>
        <!-- SECTION CONTENT END -->

    </div>
    <!-- CONTENT END -->

    <!-- FOOTER START -->
    <footer th:replace="~{fragments/footer :: footer}">
    </footer>
    <!-- FOOTER END -->

    <!-- BUTTON TOP START -->
    <button class="scroltop"><span class=" iconmoon-house relative" id="btn-vibrate"></span>Top</button>

</div>

<!-- LOADING AREA START ===== -->
<div class="loading-area">
    <div class="loading-box"></div>
    <div class="loading-pic">
        <div class="cssload-container">
            <div class="cssload-progress cssload-float cssload-shadow">
                <div class="cssload-progress-item"></div>
            </div>
        </div>
    </div>
</div>
<!-- LOADING AREA END ====== -->

<!-- JAVASCRIPT FILES ========================================= -->
<div th:replace="~{fragments/script :: common-scripts}"></div>

<!-- Additional JavaScript for Service Management -->
<script>
    $(document).ready(function () {
        // Auto-submit filter form when dropdown changes (except checkboxes)
        $('.filter-form select, .filter-form input[type="number"], .filter-form input[type="date"]').change(function () {
            // Reset page to 0 when filters change
            $('input[name="page"]').val('0');
            $(this).closest('form').submit();
        });

        // Handle checkbox changes with slight delay for better UX
        $('.filter-form input[type="checkbox"]').change(function () {
            clearTimeout(window.filterTimeout);
            window.filterTimeout = setTimeout(function () {
                $('input[name="page"]').val('0');
                $('.filter-form').submit();
            }, 500);
        });

        // Confirm delete action
        $('.site-button-danger').click(function (e) {
            if (!confirm('Are you sure you want to delete this service? This action cannot be undone.')) {
                e.preventDefault();
            }
        });

        // Trim input when user blur from field
        $('input[type="text"], input[type="number"]').on('blur', function () {
            $(this).val($(this).val().trim());
        });

        // Trim all fields before submit
        $('form').on('submit', function () {
            $(this).find('input[type="text"], input[type="number"]').each(function () {
                $(this).val($(this).val().trim());
            });
        });

        // Collapse/expand filter sections for mobile
        if ($(window).width() < 768) {
            $('.filter-wrap').addClass('collapsed');
            $('.filter-wrap h5').click(function () {
                $(this).parent().toggleClass('collapsed');
            });
        }

        // Price and duration validation
        $('input[name="minPrice"], input[name="maxPrice"]').on('input', function () {
            var val = parseFloat($(this).val());
            if (val < 0) {
                $(this).val('0');
            }
            if (val > 999999.99) {
                $(this).val('999999.99');
            }
        });

        $('input[name="minDuration"], input[name="maxDuration"]').on('input', function () {
            var val = parseInt($(this).val());
            if (val < 1) {
                $(this).val('1');
            }
            if (val > 1440) {
                $(this).val('1440');
            }
        });

        // Highlight active filters
        $('.filter-form input, .filter-form select').each(function () {
            if ($(this).val() && $(this).val() !== '') {
                $(this).addClass('active-filter');
            }
        });
    });

    // Filter validation before submit
    function validateFilters() {
        var minPrice = parseFloat($('input[name="minPrice"]').val()) || 0;
        var maxPrice = parseFloat($('input[name="maxPrice"]').val()) || Infinity;
        var minDuration = parseInt($('input[name="minDuration"]').val()) || 0;
        var maxDuration = parseInt($('input[name="maxDuration"]').val()) || Infinity;

        if (minPrice > maxPrice) {
            alert('Minimum price cannot be greater than maximum price.');
            return false;
        }

        if (minDuration > maxDuration) {
            alert('Minimum duration cannot be greater than maximum duration.');
            return false;
        }

        return true;
    }

    // Attach validation to form submit
    $('.filter-form').on('submit', validateFilters);
</script>

<style>
    /* Custom styles for service list */
    .service-icon-container {
        position: relative;
    }

    .price-badge {
        z-index: 10;
    }

    .active-filter {
        border-color: #007bff !important;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .site-button-danger {
        background-color: #dc3545;
        border-color: #dc3545;
    }

    .site-button-danger:hover {
        background-color: #c82333;
        border-color: #bd2130;
    }

    .tags-filter-container .badge {
        color: #0a0f16;
        margin-right: 5px;
        margin-bottom: 3px;
    }

    .filter-wrap.collapsed .row {
        display: none;
    }

    .filter-wrap.collapsed h5:after {
        content: ' (Click to expand)';
        font-size: 12px;
        color: #999;
    }

    @media (max-width: 768px) {
        .wt-post-readmore {
            margin-bottom: 10px;
        }

        .pagination-bx ul li {
            margin: 2px;
        }

        .filter-form .col-md-3,
        .filter-form .col-md-2,
        .filter-form .col-md-4 {
            margin-bottom: 15px;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Array of placeholder image URLs
        const images = [
            'https://picsum.photos/seed/spa1/320/180',
            'https://picsum.photos/seed/spa3/320/180',
            'https://source.unsplash.com/random/320x180/?spa'
        ];

        // Find all service containers and set random image for each
        document.querySelectorAll('.service-icon-container img').forEach(imgEl => {
            imgEl.src = images[Math.floor(Math.random() * images.length)];
        });
    });
</script>

</body>
</html>
